# 数据结构

---

## 序列上的统计

---

### 基础知识回顾

- -- ST表

- -- 树状数组

- -- 线段树
- -- 动态开点
- -- 平衡树
- -- 块状链表
- -- 并查集
- -- 优先队列
- -- 可持久化

---

### 一些简单例题

---

### bzoj2827

[传送门](https://www.lydsy.com/JudgeOnline/problem.php?id=2827)

---

### 分析

- -- 坐标什么的可以随意处理

- -- 需要维护一种数据结构，支持插入，删除，chkmax，qrysize，qrymax
- -- 随便一种平衡树打标记就可以了

---

### 区间第k小（无修改）

- 如题

---

### 分析

- -- 经典题
- -- 在主席树上二分

---

### 区间第k小（单点修改）

- 如题
- 为了简化问题，保证值域为$[1,n]$

---

### 分析

- -- 经典题，思路还是二分，关键是怎么求一个数在区间中的排名
- -- 分块$\mathcal O(\sqrt{n\log n}),\mathcal O(\sqrt{n\log n}),\mathcal O(n)$（修改，询问，空间）（下同）
- -- 树状数组/线段树套平衡树$\mathcal O(\log^2n),\mathcal O(\log^3n),\mathcal O(n\log n)$
- -- 线段树套主席树（值域）$\mathcal O(\log^2n),\mathcal O(\log^2n),\mathcal O(n\log^2n)$
- -- 时间或者空间总有一个不优

---

### 分析

- -- 考虑反过来，把值域套在外面
- -- 值域线段树套平衡树$\mathcal O(\log^2n),\mathcal O(\log^2n),\mathcal O(n\log n)$

---

### 区间第k小（单点插入）

- 如题

---

### 分析

- -- 这是一道码农题
- -- 值域线段树在内层时，外层改为平衡树
- -- 值域线段树在内层时，可以使用标号法
- -- 块状链表

---

### 一些其他题目

---

### bzoj2957

[传送门](https://www.lydsy.com/JudgeOnline/problem.php?id=2957)

---

- -- 分析一下题目，其实就是要求$\frac{H _i}{i}$严格递增
- -- 其实这也是一个经典问题
- -- 分块，每个块维护一个“可见序列”，即左起第一栋，它右边第一个能看见的，这个的右边第一个能看见的，以此类推. 在块内二分即可. 时间复杂度$\mathcal O(\sqrt{n\log n})$.
- -- 其实可以用线段树来维护，maintain的时候在右子树里二分. 时间复杂度$\mathcal O(\log^2n)$.

---

### bzoj4569

[传送门](https://www.lydsy.com/JudgeOnline/problem.php?id=4569)

---

### 分析

- -- 类似ST表，把每个信息划分成前$2^k$位和后$2^k$位
- -- 维护$\log n$个并查集，把相同性信息往下推

---

### 雅礼集训某题

给定序列$a _n$，要求支持

- 区间and一个数
- 区间or一个数
- 区间qrymax
- $n\le2\times10^5,a _i\le2^{20}$

---

### 分析

- -- and标记和or标记是可以合并的，但是下传标记的时候难以维护max
- -- 与位运算有关的问题，可以试着考虑只有一位的情况
- -- and 1和or 0无变化，and 0和or 1相当于区间赋值，线段树可以解决
- -- 考虑多位的情况，假设当前到了某个节点，如果某一位会变化（即and 0或or 1），而该节点代表的区间中，各个数这一位的值不全相同，就直接递归下去，否则打标记
- -- 记$f(i)=f(\text{lson})+f(\text{rson})+g(i)$，这里$g(i)$代表$i$节点对应的区间中有多少位不全相同，取$f(\text{root})$为势函数，容易发现均摊时间复杂度为$\mathcal O(\log n\log a)$

---

### 一些稍难的技巧

---

### 莫队算法

---

### bzoj2038

[传送门](https://www.lydsy.com/JudgeOnline/problem.php?id=2038)

---

### 分析

- -- 大家的生活不能这么散漫
- -- 莫队算法经典题目
- -- 尝试在线解决

---

### kth

- 给定序列$a _n$
- 询问区间第k小
- **对于每个询问，在询问区间中出现次数超过$w$的数视为$n$**
- 强制在线
- $0\le a _i\lt n\lt10^5$

---

### 分析

- 方便起见假设$n$和$m$同阶~~，因为我懒得区分它们~~

- -- 先忽略强制在线的条件，$\mathcal O(n\sqrt{n}\log n)$的做法还是很容易想到的
- -- 但莫队套一个线段树类的东西其实挺傻的，因为修改有$\mathcal O(n\sqrt{n})$次，但询问只有$\mathcal O(n)$次
- -- 改成莫队套分块就可以$\mathcal O(n\sqrt{n})$了
- -- 把同样的思路运用在在线莫队上

---

### xmastree1

- 给你一棵$n$个点的树，每个点有一个$[1,n]$之间的颜色，要求支持以下操作

- $1~u~l~r$ 询问$u$的子树中有多少种$l$到$r$间的颜色至少出现了一次
- $2~u~c$ 将$u$的颜色改为$c$
- 强制在线
- $n\le10^5$

---

### 分析

- -- ~~这明明是树上问题~~
- -- ~~放到dfs序上就是序列上问题了~~
- -- ~~在树上做明明更简单~~
- -- ~~一时找不到别的题来讲带修改莫队了~~
- -- emm你看我已经把做法说出来了

---

### 按时间分治

---

### loj121

[传送门](https://loj.ac/problem/121)

---

### 分析

- -- 只会插入不会删除
- -- 但我们可以撤销删除
- -- 用一棵线段树维护时间轴，每条边在若干段时间中存在，每段可以对应到线段树上$\mathcal O(\log n)$个节点
- -- dfs一遍
- -- 不要路径路径压缩

---

### 整体二分

---

### bzoj3110

[传送门](https://www.lydsy.com/JudgeOnline/problem.php?id=3110)

---

### 分析

- -- 假设你除了树状数组什么数据结构都不会了！
- -- 如果就一个询问的话可以二分
- -- 其实可以把所有的修改和询问放在一起二分，假设当前答案区间是$[l,r)$，$m=\left\lfloor\frac{l+r}{2}\right\rfloor$，右边的修改对左边一定没有贡献，左边的修改对右边一定有贡献.
- -- 可以按照左边的修改把询问也分成两部分，并统一统计左边的修改对右边的询问的贡献.

---

### cdq分治

---

### 三维数点

- RT

---

### 分析

- -- 先想想一维和二维的情况
- -- 沿用跟整体二分差不多的思路，按第一维排序，分成两半，右边对左边一定没有贡献，统计左边对右边的贡献，再分治下去即可
- -- 其实可以把分治的树结构建出来，这样如果把所有的点一次给出，可以在线回答询问

---

### 二进制分组

---

- -- 我们之前讲了只会插入不会删除的时候的一些处理技巧，那要是插入都不会呢？
- -- ~~那你会什么~~
- -- 一个典型的例子：AC自动机，我们只会离线构造
- -- 我们假设修改对询问的贡献是独立的
- -- 每次插入就在末尾加上一个大小为$1$的块，如果末尾有两个大小一样的块就把它们放在一起暴力重构
- -- 每个元素参与$\mathcal O(\log n)$次重构

---

### bzoj3533

[传送门](https://www.lydsy.com/JudgeOnline/problem.php?id=3533)

---

### 分析

- -- 答案一定在凸包上，$y\lt 0$则在下凸壳，否则在上凸壳
- -- ~~不会凸包？你退群吧~~
- -- 凸包也是难以插入但容易离线构建的典型例子
- -- 这里要做区间查询
- -- 把二进制分组放到线段树上，其实就相当于是每个节点被填满的时候构建该节点对应的凸包

---

### 二维数点

- 在线进行修改和询问
- 为什么变成二维了呢？因为时间也相当于一维，为了方便起见就不让你们做四维数点了.

---

### 分析

- -- 回忆一下我们cdq分治的做法，已经可以让询问在线
- -- 修改还不能在线的原因是分治的树结构不方便插入
- -- 所以直接上二进制分组就可以了

---

# 谢谢大家

- 时间仓促所以只有这些内容